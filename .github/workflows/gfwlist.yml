name: gfwlist Update
on:
  push:
  schedule:
    - cron: '15 16,18,20,22,0,2,4,6,8,10,12,14 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Update gfwlist (Base64 Decode to Plaintext)
      run: |
        # 1. ç¬¬ä¸€æ­¥ï¼šä¼˜å…ˆåˆ é™¤æœ¬åœ°æ—§æ–‡ä»¶ï¼ˆå½»åº•æ¸…ç©ºå†å²æ®‹ç•™ï¼‰
        echo "ğŸ”§ ç¬¬ä¸€æ­¥ï¼šå¼ºåˆ¶åˆ é™¤æœ¬åœ°æ—§çš„ youzaigfwlist æ–‡ä»¶"
        rm -f youzaigfwlist
        
        # 2. ç¬¬äºŒæ­¥ï¼šæ‹‰å–è¿œç¨‹æœ€æ–°ä»£ç ï¼ˆæ­¤æ—¶æœ¬åœ°å·²æ— æ—§æ–‡ä»¶ï¼Œé¿å…è¿œç¨‹æ—§æ–‡ä»¶è¦†ç›–ï¼‰
        echo "ğŸ”„ ç¬¬äºŒæ­¥ï¼šæ‹‰å–è¿œç¨‹ main åˆ†æ”¯æœ€æ–°ä»£ç "
        git config --local user.name "github-actions[bot]"
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git pull origin main
        
        # 3. ç¬¬ä¸‰æ­¥ï¼šä¸‹è½½å¹¶è§£ç å…¨æ–°æ–‡ä»¶ï¼ˆæ­¤æ—¶æœ¬åœ°æ— æ—§æ–‡ä»¶å¹²æ‰°ï¼Œç¡®ä¿æ˜¯æœ€æ–°å†…å®¹ï¼‰
        echo "ğŸ“¥ ç¬¬ä¸‰æ­¥ï¼šä¸‹è½½æœ€æ–° gfwlist å¹¶è§£ç ç”Ÿæˆæ–°æ–‡ä»¶"
        wget -qO- --timeout=10 https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt | base64 -d > youzaigfwlist
        
        # 4. æäº¤ä¸æ¨é€ï¼ˆå…è®¸ç©ºæäº¤ï¼Œé¿å…å†…å®¹ä¸€è‡´æ—¶æŠ¥é”™ï¼‰
        git add youzaigfwlist
        git commit --allow-empty -m "gfwlist Update: Delete old file first, then sync latest (file: youzaigfwlist) | Time: $(date +'%Y-%m-%d %H:%M:%S')"
    - name: Push to main branch
      run: git push origin main
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
