name: gfwlist Update
on:
  push:
  schedule:
    - cron: '15 16,18,20,22,0,2,4,6,8,10,12,14 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Update gfwlist (Base64 Decode to Plaintext)
      run: |
        # æ ¸å¿ƒæ­¥éª¤1ï¼šå¼ºåˆ¶åˆ é™¤æ—§çš„æ˜æ–‡æ–‡ä»¶ï¼ˆ-f ç¡®ä¿å³ä½¿æ–‡ä»¶ä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™ï¼‰
        echo "ğŸ” æ­£åœ¨åˆ é™¤æ—§çš„ youzaigfwlist æ–‡ä»¶..."
        rm -f youzaigfwlist
        
        # æ ¸å¿ƒæ­¥éª¤2ï¼šåˆ é™¤åé‡æ–°ä¸‹è½½å¹¶è§£ç ï¼Œç”Ÿæˆå…¨æ–°æ–‡ä»¶
        echo "ğŸ“¥ æ­£åœ¨ä¸‹è½½æœ€æ–° gfwlist å¹¶è§£ç ..."
        wget -qO- https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt | base64 -d > youzaigfwlist
        
        # é…ç½® Git æäº¤èº«ä»½
        git config --local user.name "github-actions[bot]"
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        
        # æ‹‰å–è¿œç¨‹æœ€æ–°ä»£ç ï¼Œé˜²æ­¢æäº¤å†²çª
        git pull origin main
        
        # ä»…æ·»åŠ æ–°ç”Ÿæˆçš„æ˜æ–‡æ–‡ä»¶åˆ° Git
        git add youzaigfwlist
        
        # å…è®¸ç©ºæäº¤ï¼ˆé¿å…æ— å†…å®¹æ›´æ–°æ—¶æµç¨‹å¤±è´¥ï¼‰ï¼Œå¹¶æ·»åŠ æ“ä½œæ—¥å¿—
        git commit --allow-empty -m "gfwlist Update: Delete old file first, then sync latest (file: youzaigfwlist) | Timestamp: $(date +'%Y-%m-%d %H:%M:%S')"
    - name: Push plaintext file to main branch
      run: git push origin main
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
