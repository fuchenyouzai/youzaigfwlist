name: GFWList Update (Auto Decode)
on:
  push:
  schedule:
    # 每两天的北京时间16:15执行（分 时 * * *，*/2 代表间隔2天）
    - cron: '15 16 */2 * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Update & Decode GFWList
      run: |
        # 1. 删除旧文件（含编码版和解码版）
        rm -f gfwlist.txt gfwlist_plain.txt
        
        # 2. 下载原始base64编码的gfwlist.txt
        wget https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt -O gfwlist.txt
        
        # 3. 用base64命令解码，生成明文文件（-d 表示解码，-i 忽略非base64字符）
        base64 -d -i gfwlist.txt > gfwlist_plain.txt
        
        # 4. 配置Git身份并拉取远程最新代码
        git config --local user.name "github-actions[bot]"
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git pull origin main
        
        # 5. 同时提交编码文件和解码后的明文文件
        git add gfwlist.txt gfwlist_plain.txt
        git commit -m "Update GFWList (base64 + plain text)"
    - name: Push changes
      run: git push origin main
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
