# 删除旧的明文文件，避免残留旧内容
rm -f youzaigfwlist

# 下载编码文件并通过管道直接解码，生成明文文件（不保留原始编码文件）
wget -qO- https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt | base64 -d > youzaigfwlist

# 配置 Git 提交身份（仅本地生效）
git config --local user.name "github-actions[bot]"
git config --local user.email "github-actions[bot]@users.noreply.github.com"

# 拉取远程最新代码，防止提交冲突
git pull origin main

# 仅添加目标明文文件到 Git 暂存区
git add youzaigfwlist

# 关键修复：检测文件是否有变更，有则提交，无则跳过
if git diff --quiet --exit-code youzaigfwlist; then
  # 无变更时输出提示，不执行提交
  echo "✅ youzaigfwlist 与远程版本一致，无更新内容，无需提交"
else
  # 有变更时执行提交
  git commit -m "gfwlist 更新：Base64 解码为明文（文件：youzaigfwlist）"
  # 若需自动推送到远程，可取消下方注释（根据实际权限配置）
  # git push origin main
fi

shell：/usr/bin/bash -e {0}
